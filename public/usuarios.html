<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Usuarios</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/semantic-ui/2.2.6/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/semantic-ui/2.2.6/semantic.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
    <script src="/js/conexion.js" ></script>
    <!--<script src="controller/auth.js"></script>-->
</head>
<body>
    <script src="js/checarConexion.js"></script>
    <header id="barraMenu"></header>
    <table class="ui compact celled definition table">
  <thead>
    <tr>
      <th></th>
      <th>Nombre</th>
      <th>Apellido</th>
      <th>Ocupacion</th>
      <th>Vigente</th>
    </tr>
  </thead>
  <tbody id="table">

  </tbody>
  <tfoot class="full-width">
    <tr>
      <th></th>
      <th colspan="4">
        <div id="show" class="ui right floated small primary labeled icon button">
          <i class="user icon"></i> Add User
        </div>
        <div class="ui small button" id="ver">
          Approve
        </div>
        <div class="ui small  disabled button">
          Approve All
        </div>
      </th>
    </tr>
  </tfoot>
</table>

<div id="datos"></div>
<button class="ui test button">Follow</button>
<div class="ui modal">
  <i class="close icon"></i>
  <div class="header">
    Profile Picture
  </div>
  <div class="image content">
    <div class="ui medium image">
      <img src="/images/avatar/large/chris.jpg">
    </div>
    <div class="description">
      <div class="ui header">We've auto-chosen a profile image for you.</div>
       <div class="ui segments">
        <div class="ui red segment">
            <p>Empleado</p>
        </div>
        <div class="ui secondary red segment">
            <div class="ui form">
                <div class="fields">
                    <div class="field">
                        <label>Nombre</label>
                        <input type="text" id="nombre" placeholder="Nombre">
                    </div>
                    <div class="field">
                        <label>Apellido</label>
                        <input type="text" id="apellido" placeholder="Apellido">
                    </div>
                    <div class="field">
                        <label>Puesto</label>
                        <input type="text" id="puesto" placeholder="Puesto">
                    </div>
                </div>

            </div>
        </div>
    </div>
    </div>
  </div>
  <div class="actions">
    <div class="ui black deny button">
      Nope
    </div>
    <div class="ui positive right animated button" tabindex="0" id="Empleado">
                    <div class="visible content">Guardar</div>
                    <div class="hidden content" id="Empresa">
                        <i class="send icon"></i>
                    </div>
    </div>
  </div>
</div>
</body>
<script src="js/traerContenido.js"></script>
    <script>

$('.ui.modal')
  .modal('attach events', '#show', 'show')
;

        firebase.auth().onAuthStateChanged(function(user) {
            firebase.database().ref('users/'+user.uid).on('child_added', function(data) {
                readTable(data.key,user.uid)

            });
        });
        function readTable(key, uid){
            var starCountRef = firebase.database().ref('users/'+uid+'/'+key);
            starCountRef.on('value', function(snapshot) {
                var username = snapshot.val().username;
                var lastname = snapshot.val().lastname;
                var ocupacion = snapshot.val().ocupacion;
                drawTable(username,lastname,ocupacion);
            });
        }
        function drawTable(username,lastname,ocupacion){
            var html =
                '<td class="collapsing">'+
                    '<div class="ui fitted slider checkbox">'+
                        '<input type="checkbox"> <label></label>'+
                    '</div>'+
                '</td>'+
                '<td>'+username+'</td>'+
                '<td>'+lastname+'</td>'+
                '<td>'+ocupacion+'</td>'+
                '<td>No</td>';
            var table = document.getElementById('table');
            var newUser = document.createElement('tr')
            newUser.innerHTML = html;
            var postElement = table.appendChild(newUser);
        }


        // Get a reference to the database service
            var database = firebase.database();

            function addEmpleado(){
                writeUserData(document.getElementById('nombre').value,
                              document.getElementById('apellido').value,
                              document.getElementById('puesto').value);

                document.getElementById('nombre').value = "";
                document.getElementById('apellido').value = "";
                document.getElementById('puesto').value = "";
            }
            function addEmpresa(){
                writeEmpresaData(document.getElementById('nombreE').value,
                              document.getElementById('giro').value,
                              document.getElementById('rfc').value);

                document.getElementById('nombreE').value = "";
                document.getElementById('giro').value = "";
                document.getElementById('rfc').value = "";
            }

            function writeUserData(nombre, apellido, puesto) {
                var user = firebase.auth().currentUser;
                  firebase.database().ref('users/'+user.uid).push().set({
                    username: nombre,
                    lastname: apellido,
                    ocupacion : puesto
                  });
            }
            function writeEmpresaData(nombreE, giro, rfc) {
                var user = firebase.auth().currentUser;
                  firebase.database().ref('empresa/'+user.uid).push().set({
                    usernameE: nombreE,
                    giro: giro,
                    rfc : rfc
                  });
            }
            document.getElementById('Empleado').addEventListener('click', addEmpleado, false);
            document.getElementById('Empresa').addEventListener('click', addEmpresa, false);
    </script>
</html>
